 <!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vintélo</title>
    <link rel="stylesheet" href="css/estilo.css">
    <link rel="stylesheet" href="css/avaliasao.css">
    <link rel="stylesheet" href="css/avaliacaoadm.css">
    <link rel="icon" href="/imagens/brilhoescuro.png" type="image/x-icon">
</head>
<body>
    <!-- Header Mobile -->
    <header class="mobile-header">
        <nav class="header-nav">
            <a href="/homeadm" class="back-btn">
                <img src="imagens/seta.png" alt="Voltar">
            </a>
            <h1>Avaliações Admin</h1>
            <a href="/homeadm" class="cart-btn">
                <img src="imagens/foto-branca.png" alt="Home">
            </a>
        </nav>
    </header>

    <!-- Header Desktop -->
    <section class="oculto-mobile">
        <section class="discount-banner">
            <span class="highlight">Painel Administrativo - Gerenciar Blog</span>
        </section>
        <header class="main-header">
            <a href="/homeadm">
                <img src="imagens/logo.png" class="img-logo">
            </a>
            <nav>
                <a href="/homeadm" class="adm">Home Admin</a>
                <a href="/denuncias" class="adm">Denúncias</a>
                <a href="/avaliacaoadm" class="adm">Avaliações</a>
                <a href="/editarbanners" class="adm">Banners</a>
            </nav>
            <section class="search-profile">
                <form>
                    <input type="text" placeholder="Buscar posts...">
                </form>
                <ul>
                    <li><a href="/homeadm"><img src="imagens/icone sem cadastro.png" class="maria"></a></li>
                    <li><a href="/homeadm"><img src="imagens/icone saco.png" class="img-tamanho"></a></li>
                    <li><a href="/homeadm"><img src="imagens/icone coraçao.png" class="img-tamanho2"></a></li>
                </ul>
            </section>
        </header>
    </section>

    <main>
        <!-- Seção de Resumo -->
        <section class="summary">
            <section class="rating-overview">
                <img src="imagens/brilhoescuro.png" alt="Avaliações" class="rating-img">
                <section class="rating-stats">
                    <h2>Vintélo</h2>
                    <p>A essência na aparência</p>
                </section>
            </section>
        </section>

        <!-- Lista de Avaliações -->
        <section class="reviews" id="reviewsList">
            <% if (avaliacoes && avaliacoes.length > 0) { %>
                <% avaliacoes.forEach(function(avaliacao, index) { %>
                    <section class="review-item" id="review-<%= avaliacao.ID_AVALIACAO %>">
                        <img src="<%= avaliacao.IMG_URL ? avaliacao.IMG_URL : 'imagens/icone sem cadastro.png' %>" alt="<%= avaliacao.NOME_USUARIO %>" class="profile-pic">
                        <section class="review-content">
                            <section class="review-header">
                                <h3><%= avaliacao.NOME_USUARIO %></h3>
                                <span class="review-date"><%= new Date(avaliacao.DATA_AVALIACAO).toLocaleDateString('pt-BR') %></span>
                            </section>
                            <p class="rating"><%= avaliacao.NOTA %> 
                                <span class="stars">
                                    <% for(let i = 1; i <= 5; i++) { %>
                                        <%= i <= avaliacao.NOTA ? '★' : '☆' %>
                                    <% } %>
                                </span>
                            </p>
                            <p class="review-text"><%= avaliacao.COMENTARIO %></p>
                        </section>
                        <section class="admin-controls">
                            <button class="btn-delete" onclick="excluirComentario(<%= avaliacao.ID_AVALIACAO %>)">Excluir</button>
                        </section>
                    </section>
                <% }); %>
            <% } else { %>
                <section class="no-reviews">
                    <p>Nenhuma avaliação encontrada.</p>
                </section>
            <% } %>
        </section>
    </main>

    <script>
        function excluirComentario(id) {
            if (confirm('Tem certeza que deseja excluir esta avaliação?')) {
                const reviewElement = document.getElementById(`review-${id}`);
                if (reviewElement) {
                    reviewElement.style.opacity = '0.5';
                    reviewElement.style.transition = 'opacity 0.3s';
                    
                    fetch(`/avaliacaoadm/excluir/${id}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            setTimeout(() => {
                                reviewElement.remove();
                                alert('Avaliação excluída com sucesso!');
                            }, 300);
                        } else {
                            reviewElement.style.opacity = '1';
                            alert('Erro ao excluir avaliação: ' + data.message);
                        }
                    })
                    .catch(error => {
                        reviewElement.style.opacity = '1';
                        alert('Erro ao excluir avaliação');
                    });
                }
            }
        }
    </script>

    <!--                                                    Rodapé                                                      -->
    <footer class="footer">
      <img src="imagens/logo2.jpeg" alt="Imagem do Rodapé" class="footer-image">
      <section class="social-media">
        <p class="p-footer">Siga nossas redes sociais</p>
        <ul class="social-links">
          <li><a href="https://facebook.com" target="_blank" class="social-link"><img src="imagens/Facebook.png"
                alt="Facebook"></a></li>
          <li><a href="https://twitter.com" target="_blank" class="social-link"><img src="imagens/Pinterest.png"
                alt="Pinterest"></a></li>
          <li><a href="https://www.instagram.com/vintelobrechos" target="_blank" class="social-link"><img
                src="imagens/Instagram.png" alt="Instagram"></a></li>
        </ul>
      </section>
      <p class="copyright">©2024 Vintélo. Todos os direitos reservados.</p>
    </footer>
</body>
</html>
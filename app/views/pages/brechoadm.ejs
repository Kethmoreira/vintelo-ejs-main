<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vistoria de Brechós - Vintélo Admin</title>
    <link rel="stylesheet" href="css/brechoadm.css">
    <link rel="icon" href="/imagens/brilhoescuro.png" type="image/x-icon">
</head>
<body>
    <!-- Header Mobile -->
    <section class="oculto-desktop">
        <header>
            <nav class="grid">
                <a href="javascript:void(0)" onclick="goBack()">
                    <img src="imagens/seta.png" alt="Voltar">
                </a>
                <img src="imagens/logo.png" alt="Logo">
                <img src="imagens/icone saco.png" class="img-branca">
            </nav>
        </header>
    </section>

    <!-- Header Desktop -->
    <section class="oculto-mobile">
        <section class="discount-banner">
            <span class="highlight">Painel Administrativo - Vistoria de Brechós</span>
        </section>
        <header class="main-header">
            <a href="/homeadm">
                <img src="imagens/logo.png" class="img-logo">
            </a>
            <nav>
                <a href="/homeadm" class="adm">Home Admin</a>
                <a href="/denuncias" class="adm">Denúncias</a>
                <a href="/avaliacaoadm" class="adm">Avaliações</a>
                <a href="/editarbanners" class="adm">Banners</a>
            </nav>
            <section class="search-profile">
                <ul>
                    <li><img src="imagens/icone sem cadastro.png" class="maria"></li>
                    <li><img src="imagens/icone saco.png" class="img-tamanho"></li>
                    <li><img src="imagens/icone saco.png" class="img-tamanho2"></li>
                </ul>
            </section>
        </header>
    </section>

    <main class="admin-container">
        <section class="admin-header">
            <h1>Vistoria de Brechós</h1>
            <p>Gerencie e monitore todos os perfis de vendedores</p>
        </section>

        <!-- Filtros -->
        <section class="filters-section">
            <select class="filter-select">
                <option value="todos">Todos os brechós</option>
                <option value="ativos">Ativos</option>
                <option value="suspensos">Suspensos</option>
                <option value="pendentes">Pendentes</option>
            </select>
            <select class="filter-select">
                <option value="todas">Todas avaliações</option>
                <option value="alta">Alta (4.5+)</option>
                <option value="media">Média (3.0-4.4)</option>
                <option value="baixa">Baixa (< 3.0)</option>
            </select>
            <input type="text" class="search-input" placeholder="Buscar por nome ou usuário...">
        </section>

        <!-- Lista de Brechós -->
        <section class="perfis-grid">
            <% if (brechos && brechos.length > 0) { %>
                <% brechos.forEach(function(brecho) { %>
                    <article class="perfil-card" data-status="<%= brecho.STATUS_USUARIO === 'a' ? 'ativo' : 'suspenso' %>">
                        <section class="perfil-header">
                            <img src="<%= brecho.IMG_URL ? brecho.IMG_URL : 'imagens/icone sem cadastro.png' %>" alt="Perfil" class="perfil-img">
                            <section class="perfil-info">
                                <h3>@<%= brecho.NOME_USUARIO.toLowerCase().replace(/\s+/g, '_') %></h3>
                                <p><%= brecho.NOME_USUARIO %></p>
                                <span class="status-badge <%= brecho.STATUS_USUARIO === 'a' ? 'ativo' : 'suspenso' %>">
                                    <%= brecho.STATUS_USUARIO === 'a' ? 'Ativo' : 'Suspenso' %>
                                </span>
                            </section>
                            <section class="perfil-stats">
                                <section class="stat">
                                    <span class="stat-number">4.5</span>
                                    <span class="stat-label">Avaliação</span>
                                </section>
                                <section class="stat">
                                    <span class="stat-number"><%= brecho.TOTAL_PRODUTOS %></span>
                                    <span class="stat-label">Produtos</span>
                                </section>
                            </section>
                        </section>
                        
                        <section class="perfil-detalhes">
                            <section class="detalhe-item">
                                <label>Email:</label>
                                <span><%= brecho.EMAIL_USUARIO %></span>
                            </section>
                            <section class="detalhe-item">
                                <label>Telefone:</label>
                                <span><%= brecho.CELULAR_USUARIO || 'Não informado' %></span>
                            </section>
                            <section class="detalhe-item">
                                <label>CNPJ:</label>
                                <span><%= brecho.CNPJ_BRECHO || 'Não informado' %></span>
                            </section>
                            <section class="detalhe-item">
                                <label>Cadastro:</label>
                                <span><%= new Date(brecho.DATA_CADASTRO).toLocaleDateString('pt-BR') %></span>
                            </section>
                            <section class="detalhe-item">
                                <label>Razão Social:</label>
                                <span><%= brecho.RAZAO_SOCIAL || 'Não informado' %></span>
                            </section>
                        </section>
                        
                        <section class="perfil-actions">
                            <button class="btn-visualizar" onclick="visualizarPerfil(<%= brecho.ID_USUARIO %>)">Visualizar</button>
                            <% if (brecho.STATUS_USUARIO === 'a') { %>
                                <button class="btn-suspender" onclick="suspenderPerfil(<%= brecho.ID_USUARIO %>)">Suspender</button>
                            <% } else { %>
                                <button class="btn-reativar" onclick="reativarPerfil(<%= brecho.ID_USUARIO %>)">Reativar</button>
                            <% } %>
                            <button class="btn-denuncias" onclick="verDenuncias(<%= brecho.ID_USUARIO %>)">Denúncias</button>
                        </section>
                    </article>
                <% }); %>
            <% } else { %>
                <section class="no-brechos">
                    <p>Nenhum brechó encontrado.</p>
                </section>
            <% } %>
        </section>
    </main>

    <script>
        function visualizarPerfil(id) {
            window.location.href = `/perfil/brecho/${id}`;
        }

        function suspenderPerfil(id) {
            if (confirm(`Tem certeza que deseja suspender o brechó ${id}?`)) {
                alert(`Brechó ${id} suspenso com sucesso!`);
                location.reload();
            }
        }

        function reativarPerfil(id) {
            if (confirm(`Tem certeza que deseja reativar o brechó ${id}?`)) {
                alert(`Brechó ${id} reativado com sucesso!`);
                location.reload();
            }
        }

        function verDenuncias(id) {
            window.location.href = `/denuncias?brecho=${id}`;
        }

        // Filtros
        document.addEventListener('DOMContentLoaded', function() {
            const filtros = document.querySelectorAll('.filter-select');
            const searchInput = document.querySelector('.search-input');
            
            filtros.forEach(filtro => {
                filtro.addEventListener('change', filtrarPerfis);
            });
            
            searchInput.addEventListener('input', filtrarPerfis);
        });

        function filtrarPerfis() {
            const cards = document.querySelectorAll('.perfil-card');
            const statusFiltro = document.querySelectorAll('.filter-select')[0].value;
            const searchTerm = document.querySelector('.search-input').value.toLowerCase();
            
            cards.forEach(card => {
                const status = card.dataset.status;
                const nome = card.querySelector('h3').textContent.toLowerCase();
                const email = card.querySelector('.detalhe-item span').textContent.toLowerCase();
                
                const matchStatus = statusFiltro === 'todos' || status === statusFiltro;
                const matchSearch = !searchTerm || nome.includes(searchTerm) || email.includes(searchTerm);
                
                if (matchStatus && matchSearch) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
    </script>

    <footer class="footer">
        <img src="imagens/logo2.jpeg" alt="Logo Vintélo" class="footer-image">
        <section class="social-media">
            <p class="p-footer">Painel Administrativo</p>
            <ul class="social-links">
                <li><a href="https://facebook.com" target="_blank" class="social-link">
                    <img src="imagens/Facebook.png" alt="Facebook">
                </a></li>
                <li><a href="https://pinterest.com" target="_blank" class="social-link">
                    <img src="imagens/Pinterest.png" alt="Pinterest">
                </a></li>
                <li><a href="https://www.instagram.com/vintelobrechos" target="_blank" class="social-link">
                    <img src="imagens/Instagram.png" alt="Instagram">
                </a></li>
            </ul>
        </section>
        <p class="copyright">©2024 Vintélo Admin. Todos os direitos reservados.</p>
    </footer>

                <script>
        window.isAuthenticated = <%= typeof autenticado !== 'undefined' && autenticado && autenticado.autenticado ? 'true' : 'false' %>;
        <% if (typeof autenticado !== 'undefined' && autenticado && autenticado.tipo) { %>
        window.userType = '<%= autenticado.tipo %>';
        <% } else if (typeof autenticado !== 'undefined' && autenticado && autenticado.autenticado) { %>
        window.userType = 'c';
        <% } %>
    </script>
    <script src="/js/navegacao.js"></script>
    <script src="/js/navegacao.js"></script>
    <script>
        function goBack() {
            window.history.back();
        }
    </script>
</body>
</html>
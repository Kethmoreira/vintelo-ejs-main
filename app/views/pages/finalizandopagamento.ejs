<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vintélo</title> 
    <link rel="stylesheet" href="css/finalizandopagamento.css"> 

    <link rel="icon" href="/imagens/brilhoescuro.png" type="image/x-icon">
    
</head>
<body>
  <section class="oculto-desktop">
    <header>
      <nav class="grid">
        <a href="/cadastro">
          <img src="imagens/seta.png" alt="Seta Voltar">
        </a>
        <img src="imagens/logo.png" alt="Logo">
        <a href="/cadastro">
          <img src="imagens/foto-branca.png" alt="Carrinho">
        </a>
      </nav>
    </header>
  </section>
  <section class="oculto-mobile">
    <header>
        <section class="top-bar">
            <p>10% OFF na primeira compra</p>
        </section>
        <section class="main-header">
          <a href="/">
            <img src="imagens/logo.png" alt="Logo Vintelo" class="img-logo">
          </a>
            <nav>
                <a href="/categorias">Vestidos</a>
                <a href="/categorias">Saias</a>
                <a href="/categorias">Blusas</a>
                <a href="/categorias">Calças</a>
                <a href="/categorias">Outros</a>
            </nav>
            <section class="search-profile oculto-mobile">
                <form>
                    <input type="text" placeholder="Buscar...">
                </form>
                <ul>
                    <li><a href="/criarbrecho"><img src="imagens/add brecho.png" class="img-tamanho" alt="Adicionar Brechó"></a></li>
                    <li><a href="/sacola1"><img src="imagens/icone saco.png" class="img-tamanho" alt="Perfil"></a></li>
                    <li><a href="/favoritos"><img src="imagens/icone coraçao.png" class="img-tamanho" alt="Favoritos"></a></li>
                </ul>
            </section>
        </section>
    </header>
  </section>
        <main class="main-mobile">
        <section class="content">
            <section class="cart">
                <% if (carrinho && carrinho.length > 0) { %>
                    <% carrinho.forEach(item => { %>
                        <img src="<%= item.imagem %>" alt="<%= item.nome %>" class="cart-item-img">
                        <section class="cart-item-info">
                            <h2><%= item.nome %></h2>
                            <% if (item.cor) { %><p>Cor: <%= item.cor %></p><% } %>
                            <% if (item.estilo) { %><p>Estilo: <%= item.estilo %></p><% } %>
                            <% if (item.estampa) { %><p>Estampa: <%= item.estampa %></p><% } %>
                            <% if (item.tamanho) { %><p>Tamanho: <%= item.tamanho %></p><% } %>
                            <p>Quantidade: <%= item.quantidade %></p>
                            <p>Preço unitário: R$ <%= item.preco.toFixed(2) %></p>
                            <p>Total</p>
                            <span>R$ <%= (item.preco * item.quantidade).toFixed(2) %></span>
                        </section>
                    <% }) %>
                <% } else { %>
                    <img src="imagens/vestido branco.png" alt="Vestido branco com decote" class="cart-item-img">
                    <section class="cart-item-info">
                        <h2>Vestido branco com decote</h2>
                        <p>Cor: Branco</p>
                        <p>Estilo: Sensual</p>
                        <p>Estampa: Simples</p>
                        <p>Total</p>
                        <span>R$ <%= total || '59,99' %></span>
                    </section>
                <% } %>
            </section>
          </section>

          <section class="content">
            <section class="section">
              <h2>Endereço de entrega</h2>
              <section class="item">
                <img src="imagens/mapa.png" alt="Ícone de localização" class="icon">
                <span>Av. Paulista</span>
                <img src="imagens/check.png" alt="Check" class="check-icon">
              </section>
            </section>
      
            <section class="section">
              <h2>Forma de pagamento</h2>
              <section class="item payment-option" onclick="selectPayment(this)">
                <img src="imagens/visa.png" alt="Visa" class="icon">
                <span>Adicionar Cartão</span>
                <img src="imagens/erro.png" alt="Erro" class="error-icon">
              </section>
              <section class="item payment-option" onclick="selectPayment(this)">
                <img src="imagens/pix.png" alt="PIX" class="icon">
                <span>PIX</span>
                <img src="imagens/check.png" alt="Check" class="check-icon">
              </section>
              <section class="item payment-option" onclick="selectPayment(this)">
                <img src="imagens/boleto.png" alt="Boleto" class="icon">
                <span>Boleto</span>
                <img src="imagens/check.png" alt="Check" class="check-icon">
              </section>
            </section>

            <!-- MERCADO PAGO 
             <section class="payment-form dark">
  <section class="block-heading">
    <h2>Checkout</h2>
  </section>

  <section class="products">
    <h3>Resumo do pedido</h3>
    <script>
      let carrinho = [
        { produto: "Produto A", qtd: 2, preco: 49.90 },
        { produto: "Produto B", qtd: 1, preco: 89.90 },
        { produto: "Produto C", qtd: 3, preco: 19.90 }
      ];

      let total = 0;
      carrinho.forEach(item => {
        total += item.qtd * item.preco;
        document.write(`
          <section class="item">
            <span class="price">R$ ${item.preco.toFixed(2)}</span>
            <span class="name">${item.produto}</span>
            <span class="quantity">Qtd: ${item.qtd}</span>
          </section>
        `);
      });

      document.write(`
        <section class="total">
          <span>Total: R$ ${total.toFixed(2)}</span>
        </section>
      `);
    </script>
  </section>
</section>
            -->

            <section class="payment-form dark">
  <section class="block-heading">
    <h2>Checkout</h2>
  </section>

  <section class="products">
    <h3>Resumo do pedido</h3>
    <% if (carrinho && carrinho.length > 0) { %>
        <% carrinho.forEach(item => { %>
            <section class="item">
                <span class="price">R$ <%= item.preco.toFixed(2) %></span>
                <span class="name"><%= item.nome %></span>
                <span class="quantity">Qtd: <%= item.quantidade %></span>
            </section>
        <% }) %>
    <% } else { %>
        <section class="item">
            <span class="price">R$ 49.90</span>
            <span class="name">Vestido branco com decote</span>
            <span class="quantity">Qtd: 1</span>
        </section>
    <% } %>
    <section class="total">
        <span>Subtotal: R$ <%= subtotal || '49,90' %></span>
    </section>
    <section class="total">
        <span>Frete: R$ <%= frete || '10,00' %></span>
    </section>
    <section class="total">
        <span>Total: R$ <%= total || '59,90' %></span>
    </section>
  </section>
</section>
            
            <section class="total">
              <span>Total</span>
              <span>R$<%= total || '59,99' %></span>
            </section>
            <section class="oculto-mobile">
              <button class="finalize-button" onclick="processarPagamento()">Finalizar compra</button>
            </section>
          </section>
          </section>
          <section class="oculto-desktop">
            <button class="finalize-button" onclick="processarPagamento()">Finalizar compra</button>
          </main>
          </section>
    </main>
     <!--                                                    Rodapé                                                      -->
     <footer class="oculto-mobile">
     <footer class="footer">
      <img src="imagens/logo2.jpeg" alt="Imagem do Rodapé" class="footer-image">
      <section class="social-media">
        <p class="p-footer">Siga nossas redes sociais</p>
        <ul class="social-links">
          <li><a href="https://facebook.com" target="_blank" class="social-link"><img src="imagens/Facebook.png" alt="Facebook"></a></li>
          <li><a href="https://twitter.com" target="_blank" class="social-link"><img src="imagens/Pinterest.png" alt="Pinterest"></a></li>
          <li><a href="https://www.instagram.com/vintelobrechos" target="_blank" class="social-link"><img src="imagens/Instagram.png" alt="Instagram"></a></li>
        </ul>
      </section>
       <p class="copyright">©2024 Vintélo. Todos os direitos reservados.</p>
    </footer>
  </section>

    <script src="js/script.js"></script>
    <script>
        function processarPagamento() {
            // Calcular valor total baseado no carrinho
            const totalElement = document.querySelector('.total span:last-child');
            const valorTotal = totalElement ? parseFloat(totalElement.textContent.replace('R$', '').replace(',', '.')) : 59.99;
            
            const formData = {
                valor: valorTotal,
                descricao: 'Compra Vintélo',
                metodo_pagamento: getSelectedPaymentMethod()
            };
            
            fetch('/processar-pagamento', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.payment_url) {
                    // Redirecionar para o Mercado Pago
                    window.location.href = data.payment_url;
                } else {
                    alert('Erro ao processar pagamento. Tente novamente.');
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao processar pagamento. Tente novamente.');
            });
        }
        
        function getSelectedPaymentMethod() {
            const selected = document.querySelector('.payment-option .check-icon:not([style*="display: none"])');
            if (selected) {
                const parent = selected.closest('.payment-option');
                const method = parent.querySelector('span').textContent;
                return method;
            }
            return 'PIX';
        }
        
        function selectPayment(element) {
            // Remover seleção anterior
            document.querySelectorAll('.payment-option .check-icon').forEach(icon => {
                icon.style.display = 'none';
            });
            document.querySelectorAll('.payment-option .error-icon').forEach(icon => {
                icon.style.display = 'block';
            });
            
            // Selecionar novo método
            const checkIcon = element.querySelector('.check-icon');
            const errorIcon = element.querySelector('.error-icon');
            if (checkIcon) checkIcon.style.display = 'block';
            if (errorIcon) errorIcon.style.display = 'none';
        }
    </script>
</body>
</html>
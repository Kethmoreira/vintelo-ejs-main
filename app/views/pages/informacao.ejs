<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vintélo</title>
    <link rel="stylesheet" href="css/informacao.css">

    <link rel="icon" href="/imagens/brilhoescuro.png" type="image/x-icon">
    
</head>
<body>
    <!-- Header Desktop -->
    <section class="desktop-header">
        <section class="top-bar">
            <p>10% OFF na primeira compra</p>
        </section>
        <header class="main-header">
            <a href="/homevendedor">
                <img src="imagens/logo.png" class="img-logo" alt="Vintélo">
            </a>
            <nav>
                <a href="/categorias">Vestidos</a>
                <a href="/categorias">Saias</a>
                <a href="/categorias">Blusas</a>
                <a href="/categorias">Calças</a>
                <a href="/categorias">Outros</a>
            </nav>
            <section class="search-profile">
                <form>
                    <input type="text" placeholder="Buscar...">
                </form>
                <ul>
                    <li><a href="/sacola1"><img src="imagens/icone saco.png" class="img-tamanho" alt="Sacola"></a></li>
                    <li><a href="/menuvendedor"><img src="<%= autenticado && autenticado.imagem ? autenticado.imagem : 'imagens/imagem sem cadastro.avif' %>" class="maria" alt="Perfil"></a></li>
                    <li><a href="favoritos"><img src="imagens/icone coraçao.png" class="img-tamanho" alt="Favoritos"></a></li>
                </ul>
            </section>
        </header>
    </section>

    <!-- Header Mobile -->
    <section class="mobile-header">
        <header>
            <nav class="grid">
                <a href="/perfilvender">
                    <img src="imagens/seta.png" alt="Voltar">
                </a>
                <img src="imagens/logo.png" alt="Vintélo">
                <a href="/menuvendedor">
                    <img src="<%= autenticado && autenticado.imagem ? autenticado.imagem : 'imagens/imagem sem cadastro.avif' %>" alt="Menu">
                </a>
            </nav>
        </header>
    </section>

    <main>
        <section class="container">
            <h1>Informações da Conta</h1>
            
            <section class="profile-wrapper">
                <!-- Sidebar de Navegação -->
                <aside class="profile-sidebar">
                    <section class="profile-info">
                        <section class="photo-upload-container">
                            <img src="<%= autenticado && autenticado.imagem ? autenticado.imagem : 'imagens/imagem sem cadastro.avif' %>" alt="Foto de perfil" class="profile-image" id="profileImage">
                            <section class="photo-upload-overlay">
                                <input type="file" id="photoInput" accept="image/*" style="display: none;">
                                <button type="button" class="photo-upload-btn" onclick="document.getElementById('photoInput').click()">
                                    +
                                </button>
                            </section>
                        </section>
                        <h2><%= autenticado && autenticado.nome ? autenticado.nome : 'Usuário' %></h2>
                        <p>@<%= autenticado && autenticado.user_usuario ? autenticado.user_usuario : 'usuario' %></p>
                    </section>
                    <nav class="profile-menu">
                        <a href="#" class="active">Dados Pessoais</a>
                        <a href="#">Endereço</a>
                        <a href="#">Segurança</a>
                        <a href="#">Preferências</a>
                        <a href="#">Notificações</a>
                    </nav>
                </aside>

                <!-- Conteúdo Principal -->
                <section class="profile-content">
                    <form class="info-form" id="profileForm" enctype="multipart/form-data">
                        <!-- Dados Pessoais -->
                        <section class="form-section active" id="dados-pessoais">
                            <h3>Dados Pessoais</h3>
                            <section class="form-row">
                                <section class="form-group">
                                    <label for="nome_usu">Nome Completo</label>
                                    <input type="text" id="nome_usu" name="nome_usu" value="<%= autenticado && autenticado.nome ? autenticado.nome : '' %>" required>
                                </section>
                                <section class="form-group">
                                    <label for="email_usu">E-mail</label>
                                    <input type="email" id="email_usu" name="email_usu" value="<%= autenticado && autenticado.email ? autenticado.email : '' %>" required>
                                </section>
                            </section>
                            
                            <section class="form-row">
                                <section class="form-group">
                                    <label for="fone_usu">Telefone</label>
                                    <input type="telefone" id="fone_usu" name="fone_usu" value="<%= (typeof usuario !== 'undefined' && usuario && usuario.telefone) ? usuario.telefone : '(11) 99999-9999' %>" required>
                                </section>
                                <section class="form-group">
                                    <label for="cnpj">CNPJ</label>
                                    <input type="text" id="cnpj" name="cnpj" value="<%= (typeof usuario !== 'undefined' && usuario && usuario.cnpj) ? usuario.cnpj : '' %>" maxlength="18" placeholder="00.000.000/0000-00" required>
                                </section>
                            </section>
                            
                            <section class="form-row">
                                <section class="form-group">
                                    <label for="razao_social">Razão Social</label>
                                    <input type="text" id="razao_social" name="razao_social" value="<%= (typeof usuario !== 'undefined' && usuario && usuario.razao_social) ? usuario.razao_social : '' %>" minlength="5" maxlength="100" required>
                                </section>
                                <section class="form-group">
                                    <label for="nome_fantasia">Nome Fantasia</label>
                                    <input type="text" id="nome_fantasia" name="nome_fantasia" value="<%= (typeof usuario !== 'undefined' && usuario && usuario.nome_fantasia) ? usuario.nome_fantasia : '' %>" minlength="2" maxlength="100" required>
                                </section>
                            </section>
                            
                            <section class="form-row">
                                <section class="form-group">
                                    <label for="data_nasc">Data de Nascimento</label>
                                    <input type="date" id="data_nasc" name="data_nasc" value="" placeholder="DD/MM/AAAA" required>
                                </section>
                                <section class="form-group">
                                    <label for="genero">Gênero</label>
                                    <select id="genero" name="genero" required>
                                        <option value="feminino" selected>Feminino</option>
                                        <option value="masculino">Masculino</option>
                                        <option value="outro">Outro</option>
                                        <option value="nao-informar">Prefiro não informar</option>
                                    </select>
                                </section>
                            </section>
                        </section>

                        <!-- Endereço -->
                        <section class="form-section" id="endereco">
                            <h3>Endereço</h3>
                            <section class="form-row">
                                <section class="form-group">
                                    <label for="cep">CEP</label>
                                    <input type="text" id="cep" name="cep" value="01234-567" required>
                                </section>
                                <section class="form-group">
                                    <label for="numero">Número</label>
                                    <input type="text" id="numero" name="numero" value="123" required>
                                </section>
                            </section>
                            
                            <section class="form-group">
                                <label for="logradouro">Logradouro</label>
                                <input type="text" id="logradouro" name="logradouro" value="Rua das Flores" required>
                            </section>
                            
                            <section class="form-row">
                                <section class="form-group">
                                    <label for="bairro">Bairro</label>
                                    <input type="text" id="bairro" name="bairro" value="Centro" required>
                                </section>
                                <section class="form-group">
                                    <label for="cidade">Cidade</label>
                                    <input type="text" id="cidade" name="cidade" value="São Paulo" required>
                                </section>
                            </section>
                            
                            <section class="form-row">
                                <section class="form-group">
                                    <label for="estado">Estado</label>
                                    <select id="estado" name="estado" required>
                                        <option value="SP" selected>São Paulo</option>
                                        <option value="RJ">Rio de Janeiro</option>
                                        <option value="MG">Minas Gerais</option>
                                    </select>
                                </section>
                                <section class="form-group">
                                    <label for="complemento">Complemento</label>
                                    <input type="text" id="complemento" name="complemento" value="Apto 45">
                                </section>
                            </section>
                        </section>

                        <!-- Segurança -->
                        <section class="form-section" id="seguranca">
                            <h3>Segurança</h3>
                            <section class="form-group">
                                <label for="senha_usu">Senha Atual</label>
                                <input type="password" id="senha_usu" name="senha_usu" placeholder="Digite sua senha atual">
                            </section>
                            
                            <section class="form-row">
                                <section class="form-group">
                                    <label for="senha_usu">Nova Senha</label>
                                    <input type="password" id="senha_usu" name="senha_usu" placeholder="Digite a nova senha">
                                </section>
                                <section class="form-group">
                                    <label for="senha-usu">Confirmar Senha</label>
                                    <input type="password" id="senha_usu" name="senha_usu" placeholder="Confirme a nova senha">
                                </section>
                            </section>
                            
                            <section class="security-options">
                                <label class="checkbox-label">
                                    <input type="checkbox" checked>
                                    <span class="checkmark"></span>
                                    Autenticação em dois fatores
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox">
                                    <span class="checkmark"></span>
                                    Notificar sobre novos logins
                                </label>
                            </section>
                        </section>

                        <!-- Preferências -->
                        <section class="form-section" id="preferencias">
                            <h3>Preferências</h3>
                            <section class="form-group">
                                <label for="categoria-favorita">Categoria Favorita</label>
                                <select id="categoria-favorita" name="categoria-favorita">
                                    <option value="vestidos" selected>Vestidos</option>
                                    <option value="blusas">Blusas</option>
                                    <option value="saias">Saias</option>
                                    <option value="calcas">Calças</option>
                                    <option value="acessorios">Acessórios</option>
                                </select>
                            </section>
                            
                            <section class="form-row">
                                <section class="form-group">
                                    <label for="tamanho-preferido">Tamanho Preferido</label>
                                    <select id="tamanho-preferido" name="tamanho-preferido">
                                        <option value="PP">PP</option>
                                        <option value="P">P</option>
                                        <option value="M" selected>M</option>
                                        <option value="G">G</option>
                                        <option value="GG">GG</option>
                                    </select>
                                </section>
                                <section class="form-group">
                                    <label for="faixa-preco">Faixa de Preço</label>
                                    <select id="faixa-preco" name="faixa-preco">
                                        <option value="ate-50">Até R$ 50</option>
                                        <option value="50-100" selected>R$ 50 - R$ 100</option>
                                        <option value="100-200">R$ 100 - R$ 200</option>
                                        <option value="acima-200">Acima de R$ 200</option>
                                    </select>
                                </section>
                            </section>
                        </section>

                        <!-- Notificações -->
                        <section class="form-section" id="notificacoes">
                            <h3>Notificações</h3>
                            <section class="notification-options">
                                <label class="checkbox-label">
                                    <input type="checkbox" checked>
                                    <span class="checkmark"></span>
                                    Receber ofertas por e-mail
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" checked>
                                    <span class="checkmark"></span>
                                    Notificações de novos produtos
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox">
                                    <span class="checkmark"></span>
                                    SMS promocionais
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" checked>
                                    <span class="checkmark"></span>
                                    Atualizações de pedidos
                                </label>
                            </section>
                        </section>

                        <section class="form-actions">
                            <button type="button" class="btn-secondary" onclick="resetForm()">Cancelar</button>
                            <button type="submit" class="btn-primary">Salvar Alterações</button>
                        </section>
                    </form>
                </section>
            </section>
        </section>
    </main>
    
    <!-- Footer -->
    <footer class="footer">
        <img src="imagens/logo.png" alt="Vintélo" class="footer-image">
        <section class="social-media">
            <p class="p-footer">Siga-nos nas redes sociais</p>
            <ul class="social-links">
                <li><a href="https://www.instagram.com/vintelobrechos" target="_blank" class="social-link"><img src="imagens/Instagram.png" alt="Instagram"></a></li>
                <li><a href="https://facebook.com" target="_blank" class="social-link"><img src="imagens/Facebook.png" alt="Facebook"></a></li>
                <li><a href="#" class="social-link"><img src="imagens/TikTok.png" alt="TikTok"></a></li>
            </ul>
        </section>
        <p class="copyright">&copy; 2024 Vintélo. Todos os direitos reservados.</p>
    </footer>

    <script src="script/informacao.js"></script>
    <script>
        // Upload de foto
        document.getElementById('photoInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('profileImage').src = e.target.result;
                };
                reader.readAsDataURL(file);
                
                // Upload da foto
                const formData = new FormData();
                formData.append('foto', file);
                
                fetch('/upload-foto', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('Foto enviada com sucesso');
                    } else {
                        alert('Erro ao enviar foto');
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    alert('Erro ao enviar foto');
                });
            }
        });
        
        // Validação e formatação de CEP
        const cepInput = document.getElementById('cep');
        if (cepInput) {
            cepInput.addEventListener('input', function() {
                this.value = formatCEP(this.value);
            });
            
            cepInput.addEventListener('blur', function() {
                if (this.value.length === 9) {
                    buscarCEP(this.value);
                }
            });
        }
        
        function formatCEP(value) {
            return value
                .replace(/\D/g, '')
                .replace(/(\d{5})(\d)/, '$1-$2')
                .replace(/(-\d{3})\d+?$/, '$1');
        }
        
        function buscarCEP(cep) {
            cep = cep.replace(/\D/g, '');
            
            if (cep.length === 8) {
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(response => response.json())
                    .then(data => {
                        if (!data.erro) {
                            document.getElementById('logradouro').value = data.logradouro || '';
                            document.getElementById('bairro').value = data.bairro || '';
                            document.getElementById('cidade').value = data.localidade || '';
                            document.getElementById('estado').value = data.uf || '';
                        }
                    })
                    .catch(error => {
                        console.log('Erro ao buscar CEP:', error);
                    });
            }
        }
        
        // Validação e formatação de CNPJ
        document.getElementById('cnpj').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{2})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1/$2');
            value = value.replace(/(\d{4})(\d)/, '$1-$2');
            e.target.value = value;
        });
        
        // Validação de CNPJ
        function validarCNPJ(cnpj) {
            cnpj = cnpj.replace(/[^\d]+/g, '');
            if (cnpj.length !== 14) return false;
            
            // Elimina CNPJs inválidos conhecidos
            if (/^(\d)\1{13}$/.test(cnpj)) return false;
            
            // Valida DVs
            let tamanho = cnpj.length - 2;
            let numeros = cnpj.substring(0, tamanho);
            let digitos = cnpj.substring(tamanho);
            let soma = 0;
            let pos = tamanho - 7;
            
            for (let i = tamanho; i >= 1; i--) {
                soma += numeros.charAt(tamanho - i) * pos--;
                if (pos < 2) pos = 9;
            }
            
            let resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
            if (resultado != digitos.charAt(0)) return false;
            
            tamanho = tamanho + 1;
            numeros = cnpj.substring(0, tamanho);
            soma = 0;
            pos = tamanho - 7;
            
            for (let i = tamanho; i >= 1; i--) {
                soma += numeros.charAt(tamanho - i) * pos--;
                if (pos < 2) pos = 9;
            }
            
            resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
            return resultado == digitos.charAt(1);
        }
        
        // Validação no envio do formulário
        document.getElementById('profileForm').addEventListener('submit', function(e) {
            const cnpj = document.getElementById('cnpj').value;
            const razaoSocial = document.getElementById('razao_social').value;
            const nomeFantasia = document.getElementById('nome_fantasia').value;
            
            // Validar CNPJ
            if (cnpj && !validarCNPJ(cnpj)) {
                e.preventDefault();
                alert('CNPJ inválido!');
                return;
            }
            
            // Validar Razão Social (mínimo 5 caracteres)
            if (razaoSocial && razaoSocial.length < 5) {
                e.preventDefault();
                alert('Razão Social deve ter pelo menos 5 caracteres!');
                return;
            }
            
            // Validar Nome Fantasia (mínimo 2 caracteres)
            if (nomeFantasia && nomeFantasia.length < 2) {
                e.preventDefault();
                alert('Nome Fantasia deve ter pelo menos 2 caracteres!');
                return;
            }
            
            // Validar CEP
            const cep = document.getElementById('cep').value;
            if (cep && !/^\d{5}-?\d{3}$/.test(cep)) {
                e.preventDefault();
                alert('CEP inválido!');
                return;
            }
        });
    </script>
</body>
</html>
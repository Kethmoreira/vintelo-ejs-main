<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vistoria de Usuários - Vintélo Admin</title>
    <link rel="stylesheet" href="css/usuariosadm.css">
    <link rel="icon" href="/imagens/brilhoescuro.png" type="image/x-icon">
</head>
<body>
    <!-- Header Mobile -->
    <section class="oculto-desktop">
        <header>
            <nav class="grid">
                <a href="javascript:void(0)" onclick="goBack()">
                    <img src="imagens/seta.png" alt="Voltar">
                </a>
                <img src="imagens/logo.png" alt="Logo">
                <img src="imagens/icone saco.png" class="img-branca">
            </nav>
        </header>
    </section>

    <!-- Header Desktop -->
    <section class="oculto-mobile">
        <section class="discount-banner">
            <span class="highlight">Painel Administrativo - Vistoria de Usuários</span>
        </section>
        <header class="main-header">
            <a href="/homeadm">
                <img src="imagens/logo.png" class="img-logo">
            </a>
            <nav>
                <a href="/homeadm">Home Admin</a>
                <a href="/denuncias">Denúncias</a>
                <a href="/avaliacaoadm">Avaliações</a>
                <a href="/editarbanners">Banners</a>
            </nav>
            <section class="search-profile">
                <form>
                    <input type="text" placeholder="Buscar...">
                </form>
                <ul>
                    <li><img src="imagens/icone sem cadastro.png" class="maria"></li>
                    <li><img src="imagens/icone saco.png" class="img-tamanho"></li>
                    <li><img src="imagens/icone saco.png" class="img-tamanho2"></li>
                </ul>
            </section>
        </header>
    </section>

    <main class="admin-container">
        <section class="admin-header">
            <h1>Vistoria de Usuários</h1>
            <p>Gerencie e monitore todos os perfis de clientes</p>
        </section>

        <!-- Filtros -->
        <section class="filters-section">
            <select class="filter-select">
                <option value="todos">Todos os usuários</option>
                <option value="ativos">Ativos</option>
                <option value="suspensos">Suspensos</option>
                <option value="novos">Novos (30 dias)</option>
            </select>
            <select class="filter-select">
                <option value="todas">Todas atividades</option>
                <option value="compradores">Compradores ativos</option>
                <option value="inativos">Sem compras</option>
            </select>
            <input type="text" class="search-input" placeholder="Buscar por nome, email ou CPF...">
        </section>

        <!-- Lista de Usuários -->
        <section class="perfis-grid">
            <% if (usuarios && usuarios.length > 0) { %>
                <% usuarios.forEach(function(usuario) { %>
                    <article class="perfil-card" data-status="<%= usuario.STATUS_USUARIO === 'a' ? 'ativo' : 'suspenso' %>">
                        <section class="perfil-header">
                            <img src="<%= usuario.IMG_URL || 'imagens/icone sem cadastro.png' %>" alt="Perfil" class="perfil-img">
                            <section class="perfil-info">
                                <h3>@<%= usuario.USER_USUARIO || 'usuario' %></h3>
                                <p><%= usuario.NOME_USUARIO %></p>
                                <span class="status-badge <%= usuario.STATUS_USUARIO === 'a' ? 'ativo' : 'suspenso' %>">
                                    <%= usuario.STATUS_USUARIO === 'a' ? 'Ativo' : 'Suspenso' %>
                                </span>
                            </section>
                            <section class="perfil-stats">
                                <section class="stat">
                                    <span class="stat-number">0</span>
                                    <span class="stat-label">Compras</span>
                                </section>
                                <section class="stat">
                                    <span class="stat-number">R$ 0</span>
                                    <span class="stat-label">Gasto</span>
                                </section>
                            </section>
                        </section>
                        
                        <section class="perfil-detalhes">
                            <section class="detalhe-item">
                                <label>Email:</label>
                                <span><%= usuario.EMAIL_USUARIO %></span>
                            </section>
                            <section class="detalhe-item">
                                <label>Telefone:</label>
                                <span><%= usuario.CELULAR_USUARIO || 'Não informado' %></span>
                            </section>
                            <section class="detalhe-item">
                                <label>CPF:</label>
                                <span>Não informado</span>
                            </section>
                            <section class="detalhe-item">
                                <label>Cadastro:</label>
                                <span><%= new Date(usuario.DATA_CADASTRO).toLocaleDateString('pt-BR') %></span>
                            </section>
                            <section class="detalhe-item">
                                <label>Última compra:</label>
                                <span>Nunca</span>
                            </section>
                        </section>
                        
                        <section class="perfil-actions">
                            <button class="btn-visualizar" onclick="visualizarPerfil(<%= usuario.ID_USUARIO %>)">Visualizar</button>
                            <% if (usuario.STATUS_USUARIO === 'a') { %>
                                <button class="btn-suspender" onclick="suspenderPerfil(<%= usuario.ID_USUARIO %>)">Suspender</button>
                            <% } else { %>
                                <button class="btn-reativar" onclick="reativarPerfil(<%= usuario.ID_USUARIO %>)">Reativar</button>
                            <% } %>
                            <button class="btn-historico" onclick="verHistorico(<%= usuario.ID_USUARIO %>)">Histórico</button>
                        </section>
                    </article>
                <% }); %>
            <% } else { %>
                <p>Nenhum usuário encontrado.</p>
            <% } %>
        </section>
    </main>

    <script>
        function visualizarPerfil(id) {
            window.location.href = `/perfil/cliente/${id}`;
        }

        function suspenderPerfil(id) {
            if (confirm(`Tem certeza que deseja suspender o usuário ${id}?`)) {
                alert(`Usuário ${id} suspenso com sucesso!`);
                location.reload();
            }
        }

        function reativarPerfil(id) {
            if (confirm(`Tem certeza que deseja reativar o usuário ${id}?`)) {
                alert(`Usuário ${id} reativado com sucesso!`);
                location.reload();
            }
        }

        function verHistorico(id) {
            window.location.href = `/usuario/historico/${id}`;
        }

        // Filtros
        document.addEventListener('DOMContentLoaded', function() {
            const filtros = document.querySelectorAll('.filter-select');
            const searchInput = document.querySelector('.search-input');
            
            filtros.forEach(filtro => {
                filtro.addEventListener('change', filtrarPerfis);
            });
            
            searchInput.addEventListener('input', filtrarPerfis);
        });

        function filtrarPerfis() {
            const cards = document.querySelectorAll('.perfil-card');
            const statusFiltro = document.querySelectorAll('.filter-select')[0].value;
            const searchTerm = document.querySelector('.search-input').value.toLowerCase();
            
            cards.forEach(card => {
                const status = card.dataset.status;
                const nome = card.querySelector('h3').textContent.toLowerCase();
                const nomeCompleto = card.querySelector('.perfil-info p').textContent.toLowerCase();
                const emailSpans = card.querySelectorAll('.detalhe-item span');
                const email = emailSpans[0] ? emailSpans[0].textContent.toLowerCase() : '';
                const cpfSpan = emailSpans[2] ? emailSpans[2].textContent.toLowerCase() : '';
                
                const matchStatus = statusFiltro === 'todos' || 
                    (statusFiltro === 'ativos' && status === 'ativo') ||
                    (statusFiltro === 'suspensos' && status === 'suspenso');
                    
                const matchSearch = !searchTerm || 
                    nome.includes(searchTerm) || 
                    nomeCompleto.includes(searchTerm) ||
                    email.includes(searchTerm) ||
                    cpfSpan.includes(searchTerm);
                
                if (matchStatus && matchSearch) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
    </script>

    <footer class="footer">
        <img src="imagens/logo2.jpeg" alt="Imagem do Rodapé" class="footer-image">
        <section class="social-media">
            <p class="p-footer">Siga nossas redes sociais</p>
            <ul class="social-links">
                <li><a href="https://facebook.com" target="_blank" class="social-link">
                    <img src="imagens/Facebook.png" alt="Facebook">
                </a></li>
                <li><a href="https://pinterest.com" target="_blank" class="social-link">
                    <img src="imagens/Pinterest.png" alt="Pinterest">
                </a></li>
                <li><a href="https://www.instagram.com/vintelobrechos" target="_blank" class="social-link">
                    <img src="imagens/Instagram.png" alt="Instagram">
                </a></li>
            </ul>
        </section>
        <p class="copyright">©2024 Vintélo. Todos os direitos reservados.</p>
    </footer>

                <script>
        window.isAuthenticated = <%= typeof autenticado !== 'undefined' && autenticado && autenticado.autenticado ? 'true' : 'false' %>;
        <% if (typeof autenticado !== 'undefined' && autenticado && autenticado.tipo) { %>
        window.userType = '<%= autenticado.tipo %>';
        <% } else if (typeof autenticado !== 'undefined' && autenticado && autenticado.autenticado) { %>
        window.userType = 'c';
        <% } %>
    </script>
    <script src="/js/navegacao.js"></script>
    <script src="/js/navegacao.js"></script>
</body>
</html>